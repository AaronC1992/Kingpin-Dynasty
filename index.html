<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kingpin Dynasty - From Dusk To Don</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="expanded-styles.css">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #000;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 10000;
        color: #e0e0e0;
        font-family: 'Georgia', serif;
    ">
        <div style="text-align: center;">
            <!-- Game Logo/Title -->
            <img src="GameLogo.png" alt="Kingpin Dynasty Logo" style="max-width: 300px; margin-bottom: 30px; filter: drop-shadow(0 0 20px rgba(212, 175, 55, 0.3));">
            
            <!-- Loading Animation -->
            <div style="margin: 30px 0;">
                <div id="loading-bar" style="
                    width: 300px;
                    height: 6px;
                    background: #1a1a1a;
                    border-radius: 3px;
                    overflow: hidden;
                    margin: 0 auto;
                    border: 1px solid #d4af37;
                ">
                    <div id="loading-progress" style="
                        width: 0%;
                        height: 100%;
                        background: linear-gradient(90deg, #8b0000, #d4af37);
                        border-radius: 3px;
                        transition: width 0.3s ease;
                    "></div>
                </div>
            </div>
            
            <!-- Loading Text -->
            <div style="margin-top: 20px;">
                <h2 style="margin: 10px 0; color: #d4af37; text-transform: uppercase; letter-spacing: 2px;">KINGPIN DYNASTY</h2>
                <p id="loading-text" style="margin: 10px 0; color: #7f8c8d; font-size: 16px; font-style: italic;">Preparing the Family business...</p>
                <p id="loading-percentage" style="margin: 5px 0; color: #8b0000; font-size: 18px; font-weight: bold;">0%</p>
                <p style="margin: 5px 0; color: #555; font-size: 12px;">Establishing connections...</p>
                <p style="margin: 15px 0; color: #d4af37; font-size: 13px; font-weight: bold;">
                    üí° The code: Silence is golden.
                </p>
            </div>
            
            <!-- Loading Spinner -->
            <div style="margin-top: 30px;">
                <div style="
                    width: 40px;
                    height: 40px;
                    border: 3px solid rgba(212, 175, 55, 0.3);
                    border-top: 3px solid #8b0000;
                    border-radius: 50%;
                    animation: spin 1s linear infinite;
                    margin: 0 auto;
                "></div>
            </div>
        </div>
    </div>
    
    <div id="game" style="display: none;">
        <!-- Stats bar at the top that is always visible -->
        <div id="stats-bar">
            <div class="player-info">
                <img id="player-portrait" src="" alt="Player" style="display: none; cursor: pointer;" onclick="cheatGrantResources()" />
                <div class="player-details">
                    <span id="player-name-display">Associate</span>
                </div>
            </div>
            <div class="stats-container">
                <p id="money-display">Cash: $0</p>
                <p id="dirty-money-display">Dirty: $0</p>
                <p id="suspicion-display">Suspicion: 0%</p>
                <p id="power-display">Influence: 0</p>
                <p id="territory-display" style="display: none;">Turf: 0 | Tribute: $0/week</p>
                <p id="health-display">Condition: 100</p>
                <p id="energy-display">Energy: 100/100</p>
                <p id="wanted-level-display">Heat: 0</p>
                <p id="level-display">Rank: 1</p>
                <p id="experience-display">XP: 0/100</p>
                <p id="skill-points-display">Skill Points: 0</p>
                <p id="season-display">Season: Spring</p>
                <p id="weather-display">Weather: ‚òÄÔ∏è Clear</p>
                <p id="active-events-display" style="display: none;">Events: None</p>
            </div>
        </div>

        <!-- Action Log -->
        <div id="action-log">
            <h3>The Ledger</h3>
            <ul id="log-list"></ul>
        </div>

        <!-- Intro Screen -->
        <div id="intro-screen" style="display:none;">
            <div style="text-align: center; margin-bottom: 30px;">
                <img src="GameLogo.png" alt="Kingpin Dynasty Logo" 
                     style="max-width: 400px; width: 90%; height: auto; border-radius: 4px; 
                            box-shadow: 0 0 30px rgba(0,0,0,0.8); border: 2px solid #d4af37;" />
            </div>
            <h1>Welcome to the Family</h1>
            <button onclick="startGame()">Join the Family</button>
            <button onclick="loadGameFromIntro()" style="background: linear-gradient(to bottom, #1a1a1a, #000); margin-left: 10px; border-color: #c0a062; color: #c0a062;">Resume Business</button>
            <button onclick="startTutorial()" style="background: linear-gradient(to bottom, #1a1a1a, #000); margin-left: 10px; border-color: #c0a062; color: #c0a062;">Learn the Ropes</button>
            <button onclick="forceNewGame()" style="background: linear-gradient(to bottom, #8b0000, #500000); margin-left: 10px; font-size: 12px; border-color: #ff0000; color: #fff;">Burn Records</button>
            <div id="intro-version" style="position: absolute; bottom: 15px; left: 15px; color: #95a5a6; font-size: 0.9em; opacity: 0.7; z-index: 10;"></div>
        </div>

        <!-- Character Creation Screen -->
        <div id="character-creation-screen" style="display: none;">
            <div id="character-creation-content">
                <h1>üé≠ Establish Your Identity</h1>
                <p>Who are you in this world? Choose wisely.</p>
                
                <div class="character-form">
                    <div class="name-section">
                        <h3>What do they call you?</h3>
                        <input type="text" id="character-name" placeholder="Enter your name..." maxlength="20" />
                    </div>
                    
                    <div class="portrait-section">
                        <h3>Choose Your Portrait</h3>
                        <div id="portrait-grid" class="portrait-selection-grid">
                            <!-- Portraits will be loaded dynamically by JavaScript -->
                        </div>
                    </div>
                    
                    <div class="character-preview">
                        <h3>Your Dossier</h3>
                        <div class="preview-card">
                            <img id="selected-portrait" src="" alt="Character Portrait" style="display: none;" />
                            <div class="preview-info">
                                <div id="preview-name">Name: Unknown</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="creation-buttons">
                        <button id="create-character-btn" onclick="createCharacter()" disabled>
                            üéØ Start Your Legacy
                        </button>
                        <button onclick="goBackToIntro()" style="background: #333; margin-left: 10px; border-color: #555; color: #aaa;">
                            ‚Üê Back
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tutorial Screen -->
        <div id="tutorial-screen" style="display:none;">
            <div id="tutorial-content">
                <h2 id="tutorial-title">The Rules</h2>
                <div id="tutorial-text"></div>
                <div id="tutorial-buttons" style="margin-top: 20px;">
                    <button onclick="previousTutorialStep()" id="prev-btn" style="display:none;">Previous</button>
                    <button onclick="nextTutorialStep()" id="next-btn">Next</button>
                    <button onclick="skipTutorial()" id="skip-btn" style="background: linear-gradient(to bottom, #8b0000, #500000); margin-left: 20px; border-color: #ff0000; color: #fff;">I Know the Drill</button>
                </div>
                <div id="tutorial-progress" style="margin-top: 15px; font-size: 14px; color: #7f8c8d;">
                    Step <span id="tutorial-step">1</span> of <span id="tutorial-total">7</span>
                    <br><span style="font-size: 12px; color: #555;">üí° Use arrow keys or Enter to navigate, Esc to skip</span>
                </div>
            </div>
        </div>

        <!-- Intro Narrative Screen -->
        <div id="intro-narrative" style="display:none;">
            <!-- Content will be dynamically generated by JavaScript -->
        </div>

        <!-- Main Menu (Simplified) -->
        <div id="menu" class="game-screen" style="display:none;">
            <div class="page-header">
                <h1><span class="icon"></span> Kingpin Dynasty</h1>
                <div class="breadcrumb">
                    <span class="current">Main Menu</span>
                </div>
            </div>
            <div class="menu-grid">
                <button class="menu-btn-unlocked" onclick="showJobs()">
                    <span class="menu-btn-label">Jobs</span>
                    <span class="menu-btn-tip">Complete tasks for cash & XP</span>
                </button>
                <button class="menu-btn-unlocked" onclick="showMissions()">
                    <span class="menu-btn-label">Operations</span>
                    <span class="menu-btn-tip">Story missions & special ops</span>
                </button>
                <button class="menu-btn-unlocked" onclick="showStolenCars()">
                    <span class="menu-btn-label">Motor Pool</span>
                    <span class="menu-btn-tip">Manage your stolen vehicles</span>
                </button>
                <button class="menu-btn-unlocked" onclick="showCommandCenter()">
                    <span class="menu-btn-label">SafeHouse</span>
                    <span class="menu-btn-tip">All features & game systems</span>
                </button>
            </div>
        </div>

        <!-- SafeHouse (Full Menu) -->
        <div id="safehouse" class="game-screen" style="display:none;">
            <div class="page-header">
                <h1><span class="icon"></span> SafeHouse</h1>
                <div class="breadcrumb">
                    <span class="current">SafeHouse</span>
                </div>
            </div>
            <div id="safehouse-grid" class="menu-grid">
                <!-- Dynamically populated by showCommandCenter() -->
            </div>
        </div>

        <!-- Gameplay Screen -->
        <div id="gameplay" class="game-screen" style="display:none;">
            <h2>Gameplay Screen</h2>
            <button onclick="showJobs()">Go to Jobs</button>
            <button onclick="showStore()">Go to Black Market</button>
        </div>

        <!-- Fence Screen -->
        <div id="fence-screen" class="game-screen" style="display:none;">
            <div class="page-header">
                <h1><span class="icon">ü§´</span> The Fence</h1>
                <div class="breadcrumb">
                    <a href="#" onclick="goBackToMainMenu(); return false;">SafeHouse</a>
                    <span class="separator">‚Ä∫</span>
                    <span class="current">The Fence</span>
                </div>
            </div>
            <p>A discreet operation for moving hot merchandise. Better rates than street prices ‚Äî if you know the right people.</p>
            <div id="fence-content"></div>
        </div>

        <!-- Store Screen -->
        <div id="store-screen" class="game-screen" style="display:none;">
            <div class="page-header">
                <h1><span class="icon"></span> Black Market</h1>
                <div class="breadcrumb">
                    <a href="#" onclick="goBackToMainMenu(); return false;">SafeHouse</a>
                    <span class="separator">‚Ä∫</span>
                    <span class="current">Black Market</span>
                </div>
            </div>
            <p>Tools of the trade. Don't ask where they came from.</p>
            
            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-top: 20px;">
                <div class="content-card">
                    <h3>Available Goods</h3>
                    <ul id="item-list" style="list-style: none; padding: 0;"></ul>
                </div>
                
                <div class="content-card">
                    <h3>Your Stash</h3>
                    <ul id="inventory-list" style="list-style: none; padding: 0;"></ul>
                </div>
            </div>
            
            <div class="page-nav">
                <button class="nav-btn-back" onclick="goBackToMainMenu()">‚Üê Back to SafeHouse</button>
            </div>
        </div>

        <!-- Real Estate Screen -->
        <div id="real-estate-screen" class="game-screen" style="display:none;">
            <div class="page-header">
                <h1><span class="icon"></span> Properties</h1>
                <div class="breadcrumb">
                    <a href="#" onclick="goBackToMainMenu(); return false;">SafeHouse</a>
                    <span class="separator">‚Ä∫</span>
                    <span class="current">Properties</span>
                </div>
            </div>
            <div class="section-header">Real Estate Portfolio</div>
            <div id="real-estate-content"></div>
            <div class="page-nav">
                <button class="nav-btn-back" onclick="goBackToMainMenu()">‚Üê Back to SafeHouse</button>
            </div>
        </div>

        <!-- Jobs Screen -->
        <div id="jobs-screen" class="game-screen" style="display:none;">
            <div class="page-header">
                <h1><span class="icon"></span> Jobs</h1>
                <div class="breadcrumb">
                    <a href="#" onclick="goBackToMainMenu(); return false;">SafeHouse</a>
                    <span class="separator">‚Ä∫</span>
                    <span class="current">Jobs</span>
                </div>
            </div>
            <div class="section-header">Available Jobs</div>
            <p>Earn your keep. Do what needs to be done.</p>
            <ul id="job-list"></ul> <!-- Dynamically filled by JS -->
            <div class="page-nav">
                <button class="nav-btn-back" onclick="goBackToMainMenu()">‚Üê Back to SafeHouse</button>
            </div>
        </div>

        <!-- Jail Screen -->
        <div id="jail-screen" class="game-screen" style="display:none;">
            <div class="page-header">
                <h1><span class="icon">üîí</span> Locked Up</h1>
                <div class="breadcrumb">
                    <span class="current">Jail</span>
                </div>
            </div>
            <div class="section-header">You've Been Pinched!</div>
            <div id="player-jail-portrait" style="text-align: center; margin: 20px 0;">
                <!-- Player portrait will be inserted here -->
            </div>
            <p id="jail-timer">You're doing time for <span id="jail-time">10</span> seconds.</p>
            <button id="breakout-button" onclick="attemptBreakout()">Attempt Escape</button>
            <button id="bribe-button" onclick="bribeGuard()" style="margin-left: 10px; background: linear-gradient(135deg, #27ae60, #2ecc71); border: none; color: white; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: bold;">üí∞ Bribe Guard</button>
            <p id="bribe-cost" style="color: #95a5a6; font-size: 0.85em; margin-top: 5px;"></p>
            
            <h3>Other Inmates</h3>
            <p>You can try to bust others out, but don't get caught.</p>
            <div id="prisoner-list"></div>
            
            <!-- TikTakToe Mini-Game Section -->
            <div id="tiktaktoe-section" style="margin-top: 30px; padding: 20px; background: #1a1a1a; border-radius: 4px; border: 2px solid #d4af37;">
                <h3 style="color: #d4af37; text-align: center;">TikTakToe with Cellmates</h3>
                <p style="text-align: center; margin-bottom: 20px;">Kill time. Stay sharp.</p>
                
                <div id="tiktaktoe-game" style="display: none;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <p id="current-player" style="font-size: 1.2em; font-weight: bold;">Your turn (X)</p>
                        <p id="game-status" style="color: #d4af37;">Playing against your cellmate</p>
                    </div>
                    
                    <div id="tiktaktoe-board" style="display: grid; grid-template-columns: repeat(3, 80px); grid-gap: 5px; justify-content: center; margin: 20px auto;">
                        <button class="tiktaktoe-cell" onclick="makeMove(0)" style="width: 80px; height: 80px; font-size: 24px; font-weight: bold; background: #333; color: #d4af37; border: 2px solid #555; border-radius: 2px; cursor: pointer;"></button>
                        <button class="tiktaktoe-cell" onclick="makeMove(1)" style="width: 80px; height: 80px; font-size: 24px; font-weight: bold; background: #333; color: #d4af37; border: 2px solid #555; border-radius: 2px; cursor: pointer;"></button>
                        <button class="tiktaktoe-cell" onclick="makeMove(2)" style="width: 80px; height: 80px; font-size: 24px; font-weight: bold; background: #333; color: #d4af37; border: 2px solid #555; border-radius: 2px; cursor: pointer;"></button>
                        <button class="tiktaktoe-cell" onclick="makeMove(3)" style="width: 80px; height: 80px; font-size: 24px; font-weight: bold; background: #333; color: #d4af37; border: 2px solid #555; border-radius: 2px; cursor: pointer;"></button>
                        <button class="tiktaktoe-cell" onclick="makeMove(4)" style="width: 80px; height: 80px; font-size: 24px; font-weight: bold; background: #333; color: #d4af37; border: 2px solid #555; border-radius: 2px; cursor: pointer;"></button>
                        <button class="tiktaktoe-cell" onclick="makeMove(5)" style="width: 80px; height: 80px; font-size: 24px; font-weight: bold; background: #333; color: #d4af37; border: 2px solid #555; border-radius: 2px; cursor: pointer;"></button>
                        <button class="tiktaktoe-cell" onclick="makeMove(6)" style="width: 80px; height: 80px; font-size: 24px; font-weight: bold; background: #333; color: #d4af37; border: 2px solid #555; border-radius: 2px; cursor: pointer;"></button>
                        <button class="tiktaktoe-cell" onclick="makeMove(7)" style="width: 80px; height: 80px; font-size: 24px; font-weight: bold; background: #333; color: #d4af37; border: 2px solid #555; border-radius: 2px; cursor: pointer;"></button>
                        <button class="tiktaktoe-cell" onclick="makeMove(8)" style="width: 80px; height: 80px; font-size: 24px; font-weight: bold; background: #333; color: #d4af37; border: 2px solid #555; border-radius: 2px; cursor: pointer;"></button>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button onclick="quitTikTakToe()" style="background: #8b0000; color: white; padding: 10px 20px; border: 1px solid #ff0000; border-radius: 2px; cursor: pointer;">
                            Quit Game
                        </button>
                    </div>
                </div>
                
                <div id="tiktaktoe-start" style="text-align: center;">
                    <p>Ready to challenge a cellmate?</p>
                    <div style="margin: 15px 0;">
                        <button onclick="startTikTakToe()" style="background: #1a1a1a; color: #c0a062; padding: 15px 25px; margin: 5px; border: 1px solid #c0a062; border-radius: 2px; cursor: pointer; font-size: 16px;">
                            Start New Game
                        </button>
                    </div>
                    <p style="font-size: 0.9em; color: #7f8c8d;">Just for fun - no money involved.</p>
                </div>
            </div>
        </div>

        <!-- Court House Screen -->
        <div id="court-house-screen" class="game-screen" style="display:none;">
            <div class="page-header">
                <h1><span class="icon"></span> Legal Aid</h1>
                <div class="breadcrumb">
                    <a href="#" onclick="goBackToMainMenu(); return false;">SafeHouse</a>
                    <span class="separator">‚Ä∫</span>
                    <span class="current">Court House</span>
                </div>
            </div>
            <div class="section-header">Fix Your Problems</div>
            <p>Bribe the right people to clear your name.</p>
            <div class="content-card">
                <button id="reset-wanted-level-court-house" onclick="resetWantedLevelCourtHouse()">Clear Heat for $0</button>
            </div>
            <div class="page-nav">
                <button class="nav-btn-back" onclick="goBackToMainMenu()">‚Üê Back to SafeHouse</button>
            </div>
        </div>

        <!-- Hospital Screen -->
        <div id="hospital-screen" class="game-screen" style="display:none;">
            <div class="page-header">
                <h1><span class="icon"></span> The Doctor</h1>
                <div class="breadcrumb">
                    <a href="#" onclick="goBackToMainMenu(); return false;">SafeHouse</a>
                    <span class="separator">‚Ä∫</span>
                    <span class="current">Hospital</span>
                </div>
            </div>
            <div class="section-header">Medical Services</div>
            <p>No questions asked. Just cash.</p>
            <div id="hospital-content"></div>
            <div class="page-nav">
                <button class="nav-btn-back" onclick="goBackToMainMenu()">‚Üê Back to SafeHouse</button>
            </div>
        </div>

        <!-- Inventory Screen -->
        <div id="inventory-screen" class="game-screen" style="display:none;">
            <div class="page-header">
                <h1><span class="icon"></span> Stash</h1>
                <div class="breadcrumb">
                    <a href="#" onclick="goBackToMainMenu(); return false;">SafeHouse</a>
                    <span class="separator">‚Ä∫</span>
                    <span class="current">Inventory</span>
                </div>
            </div>
            <div class="section-header">Your Inventory</div>
            <div class="content-card">
                <ul id="inventory-list"></ul>
                <div class="section-divider"></div>
                <p id="ammo-display-inventory">Ammo: 0</p>
                <p id="gas-display-inventory">Fuel: 0</p>
            </div>
            <div class="page-nav">
                <button class="nav-btn-back" onclick="goBackToMainMenu()">‚Üê Back to SafeHouse</button>
            </div>
        </div>

        <!-- Death Screen -->
        <div id="death-screen" class="game-screen" style="display:none;">
            <h2>Sleeping with the Fishes</h2>
            <p id="death-flavor">It's over. The Family remembers, but you are gone.</p>
            <div id="death-obituary"></div>
            <div id="death-hall-of-fame"></div>
            <button onclick="restartGame()">Start a New Life</button>
        </div>

        <!-- Pharmacy Screen -->
        <div id="pharmacy-screen" class="game-screen" style="display:none;">
            <div class="page-header">
                <h1><span class="icon"></span> Pharmacy</h1>
                <div class="breadcrumb">
                    <a href="#" onclick="goBackToMainMenu(); return false;">SafeHouse</a>
                    <span class="separator">‚Ä∫</span>
                    <span class="current">Pharmacy</span>
                </div>
            </div>
            <div class="section-header">Medical Supplies</div>
            <p>Supplies for the business.</p>
            <div class="content-card">
                <ul id="pharmacy-item-list"></ul>
            </div>
            <div class="page-nav">
                <button class="nav-btn-back" onclick="goBackToMainMenu()">‚Üê Back to SafeHouse</button>
            </div>
        </div>

        <!-- Casino Screen -->
        <div id="casino-screen" class="game-screen" style="display:none;">
            <div class="page-header">
                <h1><span class="icon"></span> Gambling Den</h1>
                <div class="breadcrumb">
                    <a href="#" onclick="goBackToMainMenu(); return false;">SafeHouse</a>
                    <span class="separator">‚Ä∫</span>
                    <span class="current">Casino</span>
                </div>
            </div>
            <div class="section-header">Test Your Luck</div>
            <div id="casino-balance" style="text-align: center; margin: 10px 0; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 8px; border: 1px solid #d4af37;">
                <span style="color: #f1c40f; font-size: 1.2em; font-weight: bold;">üí∞ Wallet: $<span id="casino-wallet">0</span></span>
            </div>
            <div class="content-card" id="casino-game-select">
                <p style="text-align:center; color:#bdc3c7;">Choose your game:</p>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; margin-top: 10px;">
                    <button id="btn-blackjack" onclick="startBlackjack()" style="padding: 15px; border-radius: 10px; border: 2px solid #27ae60; background: rgba(39,174,96,0.2); color: #ecf0f1; cursor: pointer; font-size: 1.1em;">üÉè Blackjack</button>
                    <button id="btn-slots" onclick="startSlots()" style="padding: 15px; border-radius: 10px; border: 2px solid #e67e22; background: rgba(230,126,34,0.2); color: #ecf0f1; cursor: pointer; font-size: 1.1em;">üé∞ Slots</button>
                    <button id="btn-roulette" onclick="startRoulette()" style="padding: 15px; border-radius: 10px; border: 2px solid #e74c3c; background: rgba(231,76,60,0.2); color: #ecf0f1; cursor: pointer; font-size: 1.1em;">üé° Roulette</button>
                    <button id="btn-dice" onclick="startDiceGame()" style="padding: 15px; border-radius: 10px; border: 2px solid #3498db; background: rgba(52,152,219,0.2); color: #ecf0f1; cursor: pointer; font-size: 1.1em;">üé≤ Dice</button>
                </div>
            </div>
            <div id="casino-game-area" style="margin-top: 15px;"></div>
            <div class="page-nav">
                <button class="nav-btn-back" onclick="goBackToMainMenu()">‚Üê Back to SafeHouse</button>
            </div>
        </div>

        <!-- Options Screen -->
        <div id="options-screen" class="game-screen" style="display:none;">
            <div class="page-header">
                <h1><span class="icon"></span> Settings</h1>
                <div class="breadcrumb">
                    <a href="#" onclick="goBackToMainMenu(); return false;">SafeHouse</a>
                    <span class="separator">‚Ä∫</span>
                    <span class="current">Options</span>
                </div>
            </div>
            <div class="section-header">Game Management</div>
            <div class="content-card">
                <button onclick="saveGame()">üíæ Save Game</button>
                <button onclick="showSaveSystem()">Records</button>
                <button onclick="showTutorialFromMenu()">The Rules</button>
                <button onclick="loadGame()">Resume</button>
                <button onclick="deleteSavedGame()">Burn Records</button>
                <button onclick="confirmResetGame()">Reset</button>
            </div>
            <div class="section-header">Personalization</div>
            <div class="content-card">
                <button onclick="showQuickActionCustomizer()">‚ö° Customize Quick Actions</button>
            </div>
            <div class="page-nav">
                <button class="nav-btn-back" onclick="goBackToMainMenu()">‚Üê Back to SafeHouse</button>
            </div>
            <div id="settings-version" style="text-align: right; color: #95a5a6; font-size: 0.85em; opacity: 0.7; margin-top: 15px; padding-right: 10px;"></div>
        </div>

        <!-- Skills Screen -->
        <div id="skills-screen" class="game-screen" style="display:none;">
            <div class="page-header">
                <h1><span class="icon"></span> Expertise</h1>
                <div class="breadcrumb">
                    <a href="#" onclick="goBackToMainMenu(); return false;">SafeHouse</a>
                    <span class="separator">‚Ä∫</span>
                    <span class="current">Skills</span>
                </div>
            </div>
            <div id="skills-content"></div>
        </div>

        <!-- Gang Screen -->
        <div id="gang-screen" class="game-screen" style="display:none;">
            <div class="page-header">
                <h1><span class="icon"></span> The Family</h1>
                <div class="breadcrumb">
                    <a href="#" onclick="goBackToMainMenu(); return false;">SafeHouse</a>
                    <span class="separator">‚Ä∫</span>
                    <span class="current">Gang</span>
                </div>
            </div>
            <div id="gang-content"></div>
        </div>

        <!-- Recruitment Screen -->
        <div id="recruitment-screen" class="game-screen" style="display:none;">
            <div class="page-header">
                <h1><span class="icon"></span> Recruitment</h1>
                <div class="breadcrumb">
                    <a href="#" onclick="goBackToMainMenu(); return false;">SafeHouse</a>
                    <span class="separator">‚Ä∫</span>
                    <span class="current">Recruitment</span>
                </div>
            </div>
            <div id="recruitment-content"></div>
        </div>

        <!-- Achievements Screen -->
        <div id="achievements-screen" class="game-screen" style="display:none;">
            <div class="page-header">
                <h1><span class="icon"></span> Achievements</h1>
                <div class="breadcrumb">
                    <a href="#" onclick="goBackToMainMenu(); return false;">SafeHouse</a>
                    <span class="separator">‚Ä∫</span>
                    <span class="current">Achievements</span>
                </div>
            </div>
            <div id="achievements-content"></div>
        </div>

        <!-- Vehicle Garage Screen -->
        <div id="stolen-cars-screen" class="game-screen" style="display:none;">
            <div class="page-header">
                <h1><span class="icon"></span> Motor Pool</h1>
                <div class="breadcrumb">
                    <a href="#" onclick="goBackToMainMenu(); return false;">SafeHouse</a>
                    <span class="separator">‚Ä∫</span>
                    <span class="current">Vehicles</span>
                </div>
            </div>
            <div id="stolen-cars-content"></div>
        </div>

        <!-- Jailbreak Screen -->
        <div id="jailbreak-screen" class="game-screen" style="display:none;">
            <div class="page-header">
                <h1><span class="icon"></span> Underground Network</h1>
                <div class="breadcrumb">
                    <a href="#" onclick="goBackToMainMenu(); return false;">SafeHouse</a>
                    <span class="separator">‚Ä∫</span>
                    <span class="current">Jailbreak</span>
                </div>
            </div>
            <div class="section-header">Breakout Operations</div>
            <p>Help associates get back on the street. Risky, but builds loyalty.</p>
            
            <div id="available-prisoners">
                <h3>Inmates</h3>
                <div id="jailbreak-prisoner-list"></div>
            </div>
            
            <div style="margin-top: 20px; padding: 15px; background: #1a0000; border-radius: 4px; border: 1px solid #ff0000;">
                <h4>‚ö†Ô∏è Risks</h4>
                <p>‚Ä¢ Failure means you join them</p>
                <p>‚Ä¢ Stealth helps you stay unseen</p>
                <p>‚Ä¢ Takes energy</p>
                <p>‚Ä¢ Earns respect</p>
            </div>
            
            <button onclick="refreshPrisoners()">Scout</button>
            <div class="page-nav">
                <button class="nav-btn-back" onclick="goBackToMainMenu()">‚Üê Back to SafeHouse</button>
            </div>
        </div>

        <!-- Mini Games Screen -->
        <div id="mini-games-screen" class="game-screen" style="display:none;">
            <div class="page-header">
                <h1><span class="icon"></span> Pastimes</h1>
                <div class="breadcrumb">
                    <a href="#" onclick="goBackToMainMenu(); return false;">SafeHouse</a>
                    <span class="separator">‚Ä∫</span>
                    <span class="current">Mini-Games</span>
                </div>
            </div>
            <div class="section-header">Earn While You Play</div>
            <p style="text-align: center; margin-bottom: 30px;">Kill some time. <strong style="color: #c0a062;">Win $100 for each victory!</strong></p>
            
            <!-- Game Selection Grid -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 30px 0;">
                <!-- TikTakToe -->
                <div class="mini-game-card" style="background: #1a1a1a; border-radius: 4px; padding: 25px; border: 1px solid #d4af37; text-align: center;">
                    <h3 style="color: #d4af37; margin-bottom: 15px;">TikTakToe</h3>
                    <p style="margin-bottom: 20px;">Classic strategy. <strong style="color: #c0a062;">Win: +$100</strong></p>
                    <button onclick="startMiniGameTikTakToe()" style="background: #333; color: #d4af37; padding: 12px 25px; border: 1px solid #d4af37; border-radius: 2px; cursor: pointer; font-size: 16px;">
                        Play
                    </button>
                </div>
                
                <!-- Number Guessing Game -->
                <div class="mini-game-card" style="background: #1a1a1a; border-radius: 4px; padding: 25px; border: 1px solid #c0a062; text-align: center;">
                    <h3 style="color: #c0a062; margin-bottom: 15px;">Number Hunter</h3>
                    <p style="margin-bottom: 20px;">Guess the number. <strong style="color: #c0a062;">Win: +$100</strong></p>
                    <button onclick="startNumberGuessing()" style="background: #1a1a1a; color: #c0a062; padding: 12px 25px; border: 1px solid #c0a062; border-radius: 2px; cursor: pointer; font-size: 16px;">
                        Play
                    </button>
                </div>
                
                <!-- Rock Paper Scissors -->
                <div class="mini-game-card" style="background: #1a1a1a; border-radius: 4px; padding: 25px; border: 1px solid #c0a062; text-align: center;">
                    <h3 style="color: #c0a062; margin-bottom: 15px;">Rock Paper Scissors</h3>
                    <p style="margin-bottom: 20px;">Best of 5. <strong style="color: #c0a062;">Win match: +$100</strong></p>
                    <button onclick="startRockPaperScissors()" style="background: #333; color: #c0a062; padding: 12px 25px; border: 1px solid #c0a062; border-radius: 2px; cursor: pointer; font-size: 16px;">
                        Play
                    </button>
                </div>
                
                <!-- Memory Match -->
                <div class="mini-game-card" style="background: #1a1a1a; border-radius: 4px; padding: 25px; border: 1px solid #c0a062; text-align: center;">
                    <h3 style="color: #c0a062; margin-bottom: 15px;">Memory Match</h3>
                    <p style="margin-bottom: 20px;">Match the cards. <strong style="color: #c0a062;">Under 60s: +$100 | New Best: +$500</strong></p>
                    <button onclick="startMemoryMatch()" style="background: #333; color: #c0a062; padding: 12px 25px; border: 1px solid #c0a062; border-radius: 2px; cursor: pointer; font-size: 16px;">
                        Play
                    </button>
                </div>
                
                <!-- Snake Game -->
                <div class="mini-game-card" style="background: #1a1a1a; border-radius: 4px; padding: 25px; border: 1px solid #c0a062; text-align: center;">
                    <h3 style="color: #c0a062; margin-bottom: 15px;">Snake</h3>
                    <p style="margin-bottom: 20px;">Don't hit the walls. <strong style="color: #c0a062;">Earn $50 per food!</strong></p>
                    <button onclick="startSnakeGame()" style="background: #333; color: #c0a062; padding: 12px 25px; border: 1px solid #c0a062; border-radius: 2px; cursor: pointer; font-size: 16px;">
                        Play
                    </button>
                </div>
                
                <!-- Reaction Time -->
                <div class="mini-game-card" style="background: #1a1a1a; border-radius: 4px; padding: 25px; border: 1px solid #c0a062; text-align: center;">
                    <h3 style="color: #c0a062; margin-bottom: 15px;">Quick Draw</h3>
                    <p style="margin-bottom: 20px;">Test your reflexes. <strong style="color: #c0a062;">Under 300ms: +$100 | New Best: +$500</strong></p>
                    <button onclick="startQuickDraw()" style="background: #333; color: #c0a062; padding: 12px 25px; border: 1px solid #c0a062; border-radius: 2px; cursor: pointer; font-size: 16px;">
                        Play
                    </button>
                </div>
            </div>
            
            <!-- Individual Game Areas (Hidden by Default) -->
            
            <!-- TikTakToe Game Area -->
            <div id="minigame-tiktaktoe" style="display: none; margin-top: 40px; padding: 30px; background: #1a1a1a; border-radius: 4px; border: 2px solid #d4af37;">
                <h3 style="color: #d4af37; text-align: center; margin-bottom: 20px;">TikTakToe Challenge</h3>
                
                <div id="mg-tiktaktoe-game" style="display: none;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <p id="mg-current-player" style="font-size: 1.2em; font-weight: bold;">Your turn (X)</p>
                        <p id="mg-game-status" style="color: #d4af37;">Make your move!</p>
                    </div>
                    
                    <div id="mg-tiktaktoe-board" style="display: grid; grid-template-columns: repeat(3, 80px); grid-gap: 5px; justify-content: center; margin: 20px auto;">
                        <button class="mg-tiktaktoe-cell" onclick="mgMakeMove(0)" style="width: 80px; height: 80px; font-size: 24px; font-weight: bold; background: #333; color: #d4af37; border: 2px solid #555; border-radius: 2px; cursor: pointer;"></button>
                        <button class="mg-tiktaktoe-cell" onclick="mgMakeMove(1)" style="width: 80px; height: 80px; font-size: 24px; font-weight: bold; background: #333; color: #d4af37; border: 2px solid #555; border-radius: 2px; cursor: pointer;"></button>
                        <button class="mg-tiktaktoe-cell" onclick="mgMakeMove(2)" style="width: 80px; height: 80px; font-size: 24px; font-weight: bold; background: #333; color: #d4af37; border: 2px solid #555; border-radius: 2px; cursor: pointer;"></button>
                        <button class="mg-tiktaktoe-cell" onclick="mgMakeMove(3)" style="width: 80px; height: 80px; font-size: 24px; font-weight: bold; background: #333; color: #d4af37; border: 2px solid #555; border-radius: 2px; cursor: pointer;"></button>
                        <button class="mg-tiktaktoe-cell" onclick="mgMakeMove(4)" style="width: 80px; height: 80px; font-size: 24px; font-weight: bold; background: #333; color: #d4af37; border: 2px solid #555; border-radius: 2px; cursor: pointer;"></button>
                        <button class="mg-tiktaktoe-cell" onclick="mgMakeMove(5)" style="width: 80px; height: 80px; font-size: 24px; font-weight: bold; background: #333; color: #d4af37; border: 2px solid #555; border-radius: 2px; cursor: pointer;"></button>
                        <button class="mg-tiktaktoe-cell" onclick="mgMakeMove(6)" style="width: 80px; height: 80px; font-size: 24px; font-weight: bold; background: #333; color: #d4af37; border: 2px solid #555; border-radius: 2px; cursor: pointer;"></button>
                        <button class="mg-tiktaktoe-cell" onclick="mgMakeMove(7)" style="width: 80px; height: 80px; font-size: 24px; font-weight: bold; background: #333; color: #d4af37; border: 2px solid #555; border-radius: 2px; cursor: pointer;"></button>
                        <button class="mg-tiktaktoe-cell" onclick="mgMakeMove(8)" style="width: 80px; height: 80px; font-size: 24px; font-weight: bold; background: #333; color: #d4af37; border: 2px solid #555; border-radius: 2px; cursor: pointer;"></button>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button onclick="mgQuitTikTakToe()" style="background: #8b0000; color: white; padding: 10px 20px; border: 1px solid #ff0000; border-radius: 2px; cursor: pointer;">
                            New Game
                        </button>
                    </div>
                </div>
                
                <div id="mg-tiktaktoe-start" style="text-align: center;">
                    <p>Ready to challenge the AI?</p>
                    <div style="margin: 15px 0;">
                        <button onclick="mgStartTikTakToe()" style="background: #333; color: #d4af37; padding: 15px 25px; margin: 5px; border: 1px solid #d4af37; border-radius: 2px; cursor: pointer; font-size: 16px;">
                            Start Game
                        </button>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button onclick="backToMiniGamesList()" style="background: #333; color: #aaa; padding: 12px 25px; border: 1px solid #555; border-radius: 2px; cursor: pointer;">
                        ‚Üê Back to Games
                    </button>
                </div>
            </div>
            
            <!-- Other Game Areas Will Be Added Here -->
            <div id="other-minigames" style="display: none; margin-top: 40px; padding: 30px; background: #1a1a1a; border-radius: 4px;">
                <div id="minigame-content"></div>
                <div style="text-align: center; margin-top: 20px;">
                    <button onclick="backToMiniGamesList()" style="background: #333; color: #aaa; padding: 12px 25px; border: 1px solid #555; border-radius: 2px; cursor: pointer;">
                        ‚Üê Back to Games
                    </button>
                </div>
            </div>
            
            <div class="page-nav">
                <button class="nav-btn-back" onclick="goBackToMainMenu()">‚Üê Back to SafeHouse</button>
            </div>
        </div>

        <!-- Missions Screen -->
        <div id="missions-screen" class="game-screen" style="display:none;">
            <div class="page-header">
                <h1><span class="icon"></span> Operations</h1>
                <div class="breadcrumb">
                    <a href="#" onclick="goBackToMainMenu(); return false;">SafeHouse</a>
                    <span class="separator">‚Ä∫</span>
                    <span class="current">Missions</span>
                </div>
            </div>
            <div id="missions-content">
                <!-- Content will be generated by JavaScript -->
            </div>
        </div>

        <!-- Business Management Screen -->
        <div id="business-screen" class="game-screen" style="display:none;">
            <div class="page-header">
                <h1><span class="icon"></span> Fronts</h1>
                <div class="breadcrumb">
                    <a href="#" onclick="goBackToMainMenu(); return false;">SafeHouse</a>
                    <span class="separator">‚Ä∫</span>
                    <span class="current">Businesses</span>
                </div>
            </div>
            <div id="business-content">
                <!-- Content will be generated by JavaScript -->
            </div>
        </div>

        <!-- Loan Shark Screen -->
        <div id="loan-shark-screen" class="game-screen" style="display:none;">
            <div class="page-header">
                <h1><span class="icon"></span> Shylock</h1>
                <div class="breadcrumb">
                    <a href="#" onclick="goBackToMainMenu(); return false;">SafeHouse</a>
                    <span class="separator">‚Ä∫</span>
                    <span class="current">Loan Shark</span>
                </div>
            </div>
            <div id="loan-shark-content">
                <!-- Content will be generated by JavaScript -->
            </div>
        </div>

        <!-- Money Laundering Screen -->
        <div id="money-laundering-screen" class="game-screen" style="display:none;">
            <div class="page-header">
                <h1><span class="icon"></span> The Wash</h1>
                <div class="breadcrumb">
                    <a href="#" onclick="goBackToMainMenu(); return false;">SafeHouse</a>
                    <span class="separator">‚Ä∫</span>
                    <span class="current">Money Laundering</span>
                </div>
            </div>
            <div id="money-laundering-content">
                <!-- Content will be generated by JavaScript -->
            </div>
        </div>

        <!-- Territory Control Screen -->
        <div id="territory-control-screen" class="game-screen" style="display:none;">
            <div class="page-header">
                <h1><span class="icon"></span> Turf Wars</h1>
                <div class="breadcrumb">
                    <a href="#" onclick="goBackToMainMenu(); return false;">SafeHouse</a>
                    <span class="separator">‚Ä∫</span>
                    <span class="current">Territory</span>
                </div>
            </div>
            <div id="territory-control-content">
                <!-- Content will be generated by JavaScript -->
            </div>
        </div>

        <!-- Events Screen -->
        <div id="events-screen" class="game-screen" style="display:none;">
            <div class="page-header">
                <h1><span class="icon"></span> Events</h1>
                <div class="breadcrumb">
                    <a href="#" onclick="goBackToMainMenu(); return false;">SafeHouse</a>
                    <span class="separator">‚Ä∫</span>
                    <span class="current">Events</span>
                </div>
            </div>
            <div id="events-content">
                <!-- Content will be generated by JavaScript -->
            </div>
        </div>

        <!-- Map System Screen -->
        <div id="map-screen" class="game-screen" style="display:none;">
            <div class="page-header">
                <h1><span class="icon"></span> City Map</h1>
                <div class="breadcrumb">
                    <a href="#" onclick="goBackToMainMenu(); return false;">SafeHouse</a>
                    <span class="separator">‚Ä∫</span>
                    <span class="current">Map</span>
                </div>
            </div>
            <div id="map-content">
                <!-- Content will be generated by JavaScript -->
            </div>
        </div>

        <!-- Calendar Screen -->
        <div id="calendar-screen" class="game-screen" style="display:none;">
            <div id="calendar-content">
                <!-- Content will be generated by JavaScript -->
            </div>
        </div>

        <!-- Statistics Screen -->
        <div id="statistics-screen" class="game-screen" style="display:none;">
            <div id="statistics-content">
                <!-- Content will be generated by JavaScript -->
            </div>
        </div>

        <!-- Player Stats Screen -->
        <div id="player-stats-screen" class="game-screen" style="display:none;">
            <div class="page-header">
                <span class="breadcrumb">SafeHouse &gt; Player Stats</span>
            </div>
            <div id="player-stats-content">
                <!-- Content will be generated by JavaScript -->
            </div>
            <button class="back-btn" onclick="showCommandCenter()">‚Üê Back to SafeHouse</button>
        </div>

        <!-- Right Side Panel -->
        <div id="right-panel">
            <div id="quick-actions">
                <h3>Quick Actions</h3>
                <div id="quick-actions-list">
                    <!-- Populated dynamically by updateQuickActions() -->
                </div>
            </div>
            
            <!-- Quick Stats removed -->
            
            <div id="energy-actions">
                <h3>Energy</h3>
                <div id="energy-bar">
                    <div id="energy-fill"></div>
                    <span id="energy-text">100/100</span>
                </div>
                <button id="quick-buy-energydrink" onclick="buyEnergyDrink()" class="quick-btn energy-btn">
                    Energy Drink
                </button>
                <button id="quick-buy-coffee" onclick="buyCoffee()" class="quick-btn energy-btn">
                    Strong Coffee
                </button>
                <button id="quick-buy-steroids" onclick="buySteroids()" class="quick-btn energy-btn">
                    Steroids
                </button>
            </div>
            
            <div id="objective-tracker-section">
                <h3>Current Objective</h3>
                <div id="tutorial-tracker-text" style="font-size: 0.9em; line-height: 1.4; color: #ffd700; padding: 8px; background: rgba(0,0,0,0.3); border-radius: 4px; min-height: 60px;">
                    Loading...
                </div>
            </div>
        </div>

        <!-- Hurt Flash -->
        <div id="hurt-flash"></div>
        <!-- Success Flash -->
        <div id="success-flash"></div>
    </div>

    <!-- Main game logic (Module) -->
    <script type="module" src="game.js"></script>
</body>
</html>